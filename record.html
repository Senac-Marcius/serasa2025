<!DOCTYPE html>
<html lang="pt-BR">

<head>

    <meta charset="UTF-8" />
    <title>Registro</title>
    <style>
        body{
            margin: 0
        }

        h1{
            text-align: center;
            color: #7139BF;
            background-color: #F2F2F2;
            margin: 2;
        }

        section {
            display: flex;
            margin: 0 auto;
            flex-direction: column;
            text-align: center;
        }

        #scRegister{

        }

        #scList{

        }

        .row {
            display: flex;
            margin-top: 50px;
            padding: 20px;
        }

        label {
            font: weight 600

        }

        form{
            background-color: #F2F2F2;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
           
        }
        
        button {
                background: linear-gradient(135deg, #6e8efb, #a777e3);
                color: white;
                border: none;
                padding: 12px 24px;
                font-size: 16px;
                font-weight: bold;
                border-radius: 8px;
                box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
                cursor: pointer;
                transition: all 0.3s ease-in-out;
                position: relative;
                overflow: hidden;
                margin: 20px auto 0;
                display: block;
            }

            button:hover {
                background: linear-gradient(135deg, #5b77e0, #925ec4);
                box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.3);
                transform: translateY(-2px);
            }

            button:active {
                transform: translateY(1px);
                box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.2);

            }

            button.round {
                width: 35px; 
                height: 35px;
                border-radius: 50%;

            }

            button.edit{
            background: #ffff00;
            }

            button.dell{
                background: #ff0000;
            }



    </style>
</head>

<body>
    <h1>Realize o seu registro:</h1>
    <div class="row">
    <section id="scRegister">
        <form>
            <input id="id" type = "hidden" value="-1"/>
            <label>Nome: </label><input id="name" type="text"/><br><br>
            <label>Descrição: </label><textarea id="description"></textarea><br><br>
            <label>Saúde: </label><input id="health" type="text"/><br><br>
            <label>Alergia: </label><input id="allergy" type="text"/><br><br>
            <label>Doença: </label><input id="sick" type="text"/><br><br>
            <label>Medicação: </label><input id="medication" type="text"/><br><br>
            <button type="button" id="register" onclick="handleRegister()">CADASTRAR</button>
    
        </form>
    </section>
    
    <section id="scList">
        <table>
            <thead>
                    <th>ID:</th>
            </thead>
            <tbody>

            </tbody>
        </table>
    </section>
    </div>
</body>

<script>
    var records = []

    function setRecord(req) {
        const DATE_REGEX = /^(\d{4})-(\d{2})-(\d{2})$/
        const ID_REGEX = /^\d+$/

        if (!DATE_REGEX.test(req.createAt)) {
            return "Data inválida! Use o formato YYYY-MM-DD."
        }

        if (!ID_REGEX.test(req.userId.toString())) {
            return "Campo userId deve conter apenas números"
        }

        let r = {
            id: records.length,
            name: req.name,
            description: req.description,
            health: req.health,
            allergy: req.allergy,
            sick: req.sick,
            medication: req.medication,
            createAt: req.createAt,
            userId: req.userId
        }

        records.push(r)
        return "Cadastrado com sucesso!"
    }

    function putRecord (req, id){
        let idx = records.findIndex(r => r.id == id) 

        if(idx == -1) return "Não encontrado"

        if(req.id != undefined) records[idx].id = req.id
        if(req.name != undefined) records[idx].name = req.name
        if(req.description != undefined) records[idx].description = req.description
        if(req.health != undefined) records[idx].health = req.health
        if(req.allergy != undefined) records[idx].allergy = req.allergy
        if(req.sick != undefined) records[idx].sick = req.sick
        if(req.medication != undefined) records[idx].medication = req.medication
        if(req.createAt != undefined) records[idx].creatAt = req.createAt
        if(req.userId != undefined) records[idx].userId = req.userId

        return records[idx]
    }


    function handleRegister() {
        let id = document.getElementById('id').value

        if(id == -1){

            console.log(
                setRecord ({
                    name: document.getElementById("name").value,
                    description: document.getElementById("description").value,
                    health: document.getElementById("health").value,
                    allergy: document.getElementById("allergy").value,
                    sick: document.getElementById("sick").value,
                    medication: document.getElementById("medication").value,
                    createAt: "2025-03-21",  
                    userId: 0  
                })
            )

        } else if (id > -1){

            console.log(   
            putRecord({
                name: document.getElementById("name").value,
                description: document.getElementById("description").value,
                health: document.getElementById("health").value,
                allergy: document.getElementById("allergy").value,
                sick: document.getElementById("sick").value,
                medication: document.getElementById("medication").value,
                createAt: "2025-03-21",  
                userId: 0  
            }, id))
                
            document.getElementById('id').value = -1

        }else{
            console.log("erro")
        }

        listRecord(records)

    }

    function editRecord(id){
        let record = records.find(r => r.id == id) 

        document.getElementById("description").value = record.description
        document.getElementById("name").value = record.name
        document.getElementById("health").value = record.health
        document.getElementById("allergy").value = record.allergy
        document.getElementById("sick").value = record.sick
        document.getElementById("medication").value = record.medication
        document.getElementById("id").value = record.id

    }

    function listRecord(rList){
            const tbody = document.querySelector("#scList tbody")
            tbody.innerHTML = ""

        rList.forEach(r => {
            const row = document.createElement("tr")

            const idRecord = document.createElement("td")
            idRecord.textContent = r.id;

            const editCell = document.createElement("td")
            const editButton = document.createElement("button")
            editButton.className = "round edit"
            editButton.onclick = function() {
                    editRecord(r.id)
            }
            editCell.appendChild(editButton)


            const dellCell = document.createElement("td")
            const dellButton = document.createElement("button")
            dellButton.className = "round dell"
            dellCell.appendChild(dellButton)


            row.appendChild(idRecord)
            row.appendChild(editCell)
            row.appendChild(dellCell)


            tbody.appendChild(row)
        })
    }
</script>
</html>
