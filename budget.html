<!DOCTYPE html>
    <head>
        <meta charset="UTF-8" />
        <title>orçamento</title>
        <style>
            section {
                display: flex;
                margin: 0 auto;
                flex-direction: column;

            }
            body{
                margin: 0;
            }
            h1{
                text-align: center;
                color: #4EB1D9;
                 background-color: #F2F2F2;
                margin: 0;
            }
            #scRegister{

            }
            #scList{

            }

            .row {
                display: flex;
                margin-top: 50px;
                padding: 20px;
            }

            label {
                font-weight: 600;

            }

            br {
                margin: 5px
            }
            button {
                background: linear-gradient(135deg, #6e8efb, #a777e3);
                color: white;
                border: none;
                padding: 12px 24px;
                font-size: 16px;
                font-weight: bold;
                border-radius: 8px;
                box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
                cursor: pointer;
                transition: all 0.3s ease-in-out;
                position: relative;
                overflow: hidden;
                margin: 20px auto 0;
                display: block;
            }

            button:hover {
                background: linear-gradient(135deg, #5b77e0, #925ec4);
                box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.3);
                transform: translateY(-2px);
            }

            button:active {
                transform: translateY(1px);
                box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.2);
            }

            button.round {
               width: 35px;
               height: 35px;
               border-radius: 50%;
            }

            button.dell{
                background: #ff0000;
            }

            button.edit{
                background: #ffff00;
            }


        form{
            background-color: #F2F2F2;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
        }
        </style>
    </head>
    <boby>
            <h1>cadastre seu orçamento</h1>
            <div class="row">
                <section id="scRegister">
                    <form>
                    <input id="id" type="hidden" value="-1"/>
                    <label>Nome: </label><input id="name" type="text"/><br><br>
                    <label>Url: </label><input id="url" type="text"/><br><br>
                    <label>Valor: </label><input id="value" type="number"/><br><br>
                    <label>Data Inicial: </label><input id="startDate" type="Date"/><br><br>
                    <label>Data Final: </label><input id="endDate" type="Date"/><br><br>
                    <button type="button" id="register" onclick="handleRegister()">CADASTRAR</button>
                    </form>
                </section>

                <section id="scList">
                    <table>
                        <thead>
                            <th>nome</th>
                            <tbody>

                            </tbody>
                        </thead>
                    </table>
                </section>
        </div>
    </boby>
    <script>
        let ocements = []

        function setBudget(req){
           
            const urlPattern = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;
            const valuePattern =/^\d+(\.\d{1,2})?$/;
            const startDatePattern = /^\d{4}-\d{2}-\d{2}$/;
            const endDatePattern = /^\d{4}-\d{2}-\d{2}$/;            
           

            if (! urlPattern.test(req.url)){
                return "campo url deve conter o seguinte formato https://dominio."
            }
            if(!valuePattern.test (req.value)){
                return "o campo value deve conter apenas digitos"
            }

            if (!startDatePattern.test(req.startDate)){
                return "campo createAt deve contar o seguinte formato YYYY-MM-DD"
            }

            if (!endDatePattern.test(req.endDate)){
                return "campo createAt deve contar o seguinte formato YYYY-MM-DD"
            }

            if (req.name.length > 100) {
                return "campo name deve conter até 100 caracteres"
            }
            let b = {
                id: ocements.length? ocements [ocements.length - 1].id + 1 : 0,
                name: req.name,
                url:req.url,
                createAt: req.createAt,
                userId: req.userId,
                value: req.value,
                startDate: req.startDate,
                endDate: req.endDate
            
            }
            ocements.push(b)
            return "budget cadastrado"
        }

        function putOcements (req, id){
            let idx = ocements.findIndex(b => b.id == id)

            if(idx == -1) return "Não encontrado"

            if(req.name != undefined) ocements [idx] .name = req.name
            if(req.url != undefined) ocements [idx] .url = req.url
            if(req.createAt != undefined) ocements [idx] .createAt = req.createAt
            if(req.userId != undefined) ocements [idx] .userId = req.userId
            if(req.value != undefined) ocements [idx] .value = req.value
            if(req.startDate != undefined) ocements [idx] .startDate = req.startDate
            if(req.endDate != undefined) ocements [idx] .endDate = req.endDate
        
        return ocements[idx]

        }

        function dellbudget(id){
        
            ocements = ocements.filter(b => b.id !== id);
            listocements(ocements);
        }

        function handleRegister(){
            let id = document.getElementById('id').value
    
            if(id == -1){
                    setBudget({
                    
                    name: document.getElementById("name").value, 
                    url: document.getElementById("url").value,
                    createAt: "2023-01-30",
                    userId: 0,
                    value: document.getElementById("value").value,
                    startDate: document.getElementById("startDate").value,
                    endDate: document.getElementById("endDate").value, 

                })
            
        
            }else if (id > -1){

                putOcements( {
                    
                    name: document.getElementById("name").value, 
                    url: document.getElementById("url").value,
                    createAt: "2023-01-30",
                    userId: 0,
                    value: document.getElementById("value").value,
                    startDate: document.getElementById("startDate").value,
                    endDate: document.getElementById("endDate").value, 

                }, id) 

          
            }else{
                
                console.log("erro")
            }

            document.getElementById('id').value = -1
            listOcements(ocements)  
    
        }


        function editBudget(id){
            let budget = ocements.find(b => b.id == id)
            document.getElementById("name").value = budget.name
            document.getElementById("url").value = budget.url
            document.getElementById ("value").value = budget.value
            document.getElementById ("startDate").value = budget.startDate
            document.getElementById ("endDate").value = budget.endDate
            document.getElementById ("id").value = budget.id
        }

        function dellBudget(id){
            let idx = ocements.findIndex (b => b.id == id)

            if (idx == -1) return "Não encontrado"

            ocements.splice(idx, 1)

            listOcements(ocements)  

            return "oçamento excluida com sucesso"

        }


        function listOcements(bList){
            const tbody = document.querySelector("#scList tbody")
            tbody.innerHTML =""

            ocements.forEach(b => {
                const row = document.createElement("tr");
    
                    const nameCell = document.createElement("td");
                    nameCell.textContent = b.name;
    
                    const editCell = document.createElement("td");
                    const editButton = document.createElement("button");
                    editButton.className = "round edit";
                    editButton.onclick = function(){
                        editBudget(b.id)
                    };
                    editCell.appendChild(editButton);
    
                    const dellCell = document.createElement("td");
                    const dellButton = document.createElement("button");
                    dellButton.className = "round dell";
                    dellButton.onclick = function(){
                        dellBudget(b.id);
                    };
                    dellCell.appendChild(dellButton);
    
            
    
                    row.appendChild(nameCell);
                    row.appendChild(editButton);
                    row.appendChild(editCell);
                    row.appendChild(dellButton);
                    row.appendChild(dellCell);
                    tbody.appendChild(row);
                
                
            
            })
        }
    </script>
</html>

