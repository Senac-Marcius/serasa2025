<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <title>Projeto Integrador</title>
        <style>
            body{
                border-radius: 10px;
            }

            h1{
                text-align: center;
                color: #bf54a3;
                background-color: #f2f2f2;
                border-radius: 10px;

            }

            section {
                display: flex;
                margin: 0 auto;
                flex-direction: column;
            }

            #scRegister{
                text-align: left;
                color: #bf54a3;
                background-color: #f2f2f2;
                border-radius: 10px;
            }

            #scList{
                text-align: -webkit-right;
                color: #bf54a3;
                background-color: #f2f2f2;
                border-radius: 10px;
            }

            .row{
                display: flex;  
                margin-top: 50px;
                padding: 20px;
            }

            label {
                font-weight: 600;
            }

            button {
                background: linear-gradient(135deg, #6e8efb, #a777e3);
                color: white;
                border: none;
                padding: 12px 24px;
                font-size: 16px;
                font-weight: bold;
                border-radius: 10px;
                box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
                cursor: pointer;
                transition: all 0.3s ease-in-out;
                position: relative;
                overflow: hidden;
                margin: 20px auto 0;
                display: block;               
            }

            button:hover {
                background: linear-gradient(135deg, #5b77e0, #925ec4);
                box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.3);
                transform: translateY(-10px);
            }

            button:active {
                transform: translateY(1px);
                box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.2);
            }

            button.roud {
                width: 35px;
                height: 35px;
                border-radius: 50%;
            }

            form {
                background-color: #f2f2f2;
                padding: 40px;
                border-radius: 0px 4px 10px rgba(0, 0,0, 0.2);
                
            }

            button.edit {
                background: #ffff00; 
            }

            
            button.dell {
                background: #ff0000; 
            }

        </style>

    </head>
    <body>
        
        <h1>Formulário para cadastro de Projeto:</h1>
        <div class="row">
            <section id="scRegister">
                <form>
                    <input id="id" value="-1" type="hidden"/>
                    <label>Criador do Projeto:</label>  
                    <input id="nameuser" type="text" placeholder="Nome Completo"/> 
                    <input id="cpf" type="text" placeholder="CPF" maxlength="14" oninput="formatCPF(this)" />
                    E-mail 
                    <input type="email" placeholder="email@gmail.com"/> <br><br>
                    
                    <label>Nome do Projeto:</label>  
                    <input id="namep" type="text" />
                    <label>Site:</label>  
                    <input id="website" type="url" placeholder=" https://siteprojeto.org.br" onblur="ensureProtocol()" /><br><br>
                    
                    <label>Previsao de início:</label>  
                    <input id="createAt" type="date" /><br><br>
                    
                    <label>Qual o periodo do projeto:</label>  
                    <input id="createAt" type="date" /> á 
                    <input type="date" />  
                    / <input id="Indeterminado" type="checkbox" name="Indeterminado" /> Indeterminado<br><br>
                    
                    <label>Descrição do Projeto:</label> <br>
                    <textarea id="description" placeholder="Visão geral"></textarea><br><br>
                    
                    <label>Objetivo:</label> <br>
                    <textarea id="objective" placeholder="Simplificado se possivel"></textarea><br><br>
                    
                    <label>Recursos:</label>  
                    <input id="resources" type="text" name="valor" placeholder="R$ 0,00" /> Aproximadamente<br><br>
                    
                    <label>Qual a Atividade que será proposta pelo projeto:</label> <br>
                    <textarea id="activity" placeholder="Tópicos" ></textarea><br><br>
                    
                    <label>Quais metodologias pretende abordar: <br>

                        <textarea id="tecnic" placeholder="Técnicas" ></textarea>
                        <textarea id="process" placeholder="Processos" ></textarea>
                        <textarea id="strategy" placeholder="Estratégias" ></textarea>
                        <textarea id="planning" placeholder="Planejamento" ></textarea><br><br>
                        <button type="button" id="register" onclick="handleRegister()"> Cadastrar </button>
                </form>

            </section>
        
            <section id="scList">

                <table>
                    <thead>
                        <th>Nome Do Projeto</th><br>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
            </section>
        </div>
    </body>
    <script>
        function ensureProtocol() {
                let websiteInput = document.getElementById("website");
                let websiteValue = websiteInput.value.trim();

                // Verifica se a URL começa com http:// ou https://
                if (websiteValue && !/^https?:\/\//i.test(websiteValue)) {
                    // Adiciona https:// se não tiver o protocolo
                    websiteInput.value = "https://" + websiteValue;
                }
            }
        
        function 
            formatCPF(campo) {
                let cpf = campo.value.replace(/\D/g, ''); // Remove tudo o que não for número
                if (cpf.length <= 3) {
                    campo.value = cpf;
                } else if (cpf.length <= 6) {
                    campo.value = cpf.replace(/(\d{3})(\d{1,})/, '$1.$2');
                } else if (cpf.length <= 9) {
                    campo.value = cpf.replace(/(\d{3})(\d{3})(\d{1,})/, '$1.$2.$3');
                } else if (cpf.length <= 11) {
                    campo.value = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{1,})/, '$1.$2.$3-$4');
                }
            }

        var projects = []

        function setProject(req){
            const urlPattern = /^(https?:\/\/)[^\s$.?#].[^\s]*$/;

            let p = {
                namep: req.namep,
                name: req.name,
                id: projects.length? projects[projects.length -1].id+1 : 0,
                url: req.url,
                createAt: req.createAt, // yyyy-MM-DD
                userid: req.userid,
                resources: req.resources,
                description: req.description,
                activity: req.activity,
                timeline: req.timeline,
                objective: req.objective,
                methodology: req.methodology
            }

            projects.push(p)
            return "Projeto Cadastrado"
        }
        
        function putProjects(req,id){
            let idx = projects.findIndex(p => p.id == id)

            if(idx == -1) return "Não Encontrado"

            if(req.id != undefined) projects[idx].id = req.id
            if(req.name != undefined) projects[idx].name = req.name
            if(req.namep != undefined) projects[idx].namep = req.namep
            if(req.url != undefined) projects[idx].url = req.url
            if(req.createAt != undefined) projects[idx].createAt = req.createAt
            if(req.resources != undefined) projects[idx].resources = req.resources
            if(req.activity != undefined) projects[idx].activity = req.activity
            if(req.description != undefined) projects[idx].description = req.description
            if(req.objective != undefined) projects[idx].objective = req.objective
            if(req.timeline != undefined) projects[idx].timeline = req.timeline
            if(req.methodology != undefined) projects[idx].methodology = req.methodology

            return projects[idx]
        }

        function handleRegister(){// handle é usado para chamar a função
            let id = document.getElementById('id').value

            if(id == -1){
                console.log(
                    setProject({
                        id: id,
                        name: document.getElementById("nameuser").value,
                        namep: document.getElementById("namep").value,
                        url: document.getElementById("website").value,
                        createAt: document.getElementById("createAt").value,
                        userid: document.getElementById("cpf").value,
                        resources: document.getElementById("resources").value,
                        description: document.getElementById("description").value, 
                        activity: document.getElementById("activity").value,
                        timeline: "6 meses apos o inicio do projeto, realocando o mesmo em outro lugar por mais 6 meses num periodo de 3 anos",
                        objective: document.getElementById("objective").value,
                        methodology: "Técnica: " + document.getElementById("tecnic").value + 
                                    " | Processos: " + document.getElementById("process").value + 
                                    " | Estratégias: " + document.getElementById("strategy").value +
                                    " | Planejamento: " + document.getElementById("planning").value
                    })
                )
            }else if(id > -1){
                console.log(  
                    putProjects({
                            id: id,
                            name: document.getElementById("nameuser").value,
                            namep: document.getElementById("namep").value,
                            url: document.getElementById("website").value,
                            createAt: document.getElementById("createAt").value,
                            userid: document.getElementById("cpf").value,
                            resources: document.getElementById("resources").value,
                            description: document.getElementById("description").value, 
                            activity: document.getElementById("activity").value,
                            timeline: "6 meses apos o inicio do projeto, realocando o mesmo em outro lugar por mais 6 meses num periodo de 3 anos",
                            objective: document.getElementById("objective").value,
                            methodology: "Técnica: " + document.getElementById("tecnic").value + 
                                        " | Processos: " + document.getElementById("process").value + 
                                        " | Estratégias: " + document.getElementById("strategy").value +
                                        " | Planejamento: " + document.getElementById("planning").value
                        }, id)
                    )
                
                    
            }else{
                console.log("erro")
            }
            document.getElementById('id').value = -1
            listProjects(projects)
        }

        function editProject(id){
            let project = projects.find(p => p.id == id)

            document.getElementById("description").value = project.description
            document.getElementById("namep").value = project.namep
            document.getElementById("id").value = project.id  // Define o ID do projeto para edição
        } 
        function dellProject(id){
            let idx = projects.findIndex(p => p.id == id)
            if(idx == -1) return "não econtrado"
            
            projects.splice(idx, 1)
            
            listProjects(projects)
            return "deletado com sucesso"
        }

        function listProjects(plist){
            const tbody = document.querySelector("#scList tbody")
            tbody.innerHTML = "";

            projects.forEach(p => {    // se utiliza quando se quer utilizar a mesma função para todos os vetores e dentro do tbody vai um "tr"
                const row = document.createElement("tr")

                const namepCell = document.createElement("td")
                namepCell.textContent = p.namep

                const editCell = document.createElement("td")
                const editButton = document.createElement("button")
                editButton.className = "edit"
                editButton.textContent = "Editar"
                editButton.onclick = function() {
                    editProject(p.id)
                }
                editCell.appendChild(editButton)

                
                const dellCell = document.createElement("td")
                const dellButton = document.createElement("button")
                dellButton.className = "dell"
                dellButton.textContent = "Deletar"
                dellButton.onclick = function() {
                    dellProject(p.id)
                }
                dellCell.appendChild(dellButton)

                
                row.appendChild(namepCell)
                row.appendChild(editCell) //Deletar
                row.appendChild(dellCell) //Editar

                tbody.appendChild(row)

            })
        }

       
    </script>
</html>