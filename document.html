<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="style.css" media="screen">
        <title>Documentos</title>
    </head>
    <body>
        <h1>Cadastro de Solicitação</h1>
        <section>     

            <form id="scRegister">
                <input id="id" type="hidden" value="-1"/>
                <label for="name">Nome Completo: </label><input id="name" type="text"><br><br>
                <label for="email">E-mail: </label><input id="email" type="text"><br><br>
                <label for="telephone">Telefone: </label><input id="telephone" type="tel"><br><br>
                <label for="rg">RG: </label><input id="rg" type="text"><br><br>
                <label for="dateBirth">Data de Nascimento: </label><input id="dateBirth" type="date"><br><br>
                <label for="nameMother">Nome da mãe: </label><input id="nameMother" type="text"><br><br>
                <label for="level">Turma: </label><input id="level" type="text"><br><br>
                <label for="grade">Nível: </label><input id="grade" type="text"><br><br>
                <label for="period">Período: </label>
                <select id="period" name="opcoes">
                    <option id="opcao1" value="manha">Manhã</option>
                    <option id="opcao2" value="tarde">Tarde</option>
                    <option id="opcao3" value="noite">Noite</option>
                </select>
                <br><br><br>
                <button type="button" id="register" onclick="handleRegister()">ENVIAR</button>            
            </form>
        </section>

        <section id="scList">
            <table>
                <thead>
                    <tr>
                        <th>Nome</th>
                    </tr>                    
                </thead>
                <tbody id="tableBody">                                                
                </tbody>
            </table>

        </section>

    </body>

    <script>
        //Atributos = campos de um formulário
        /*documentos - prontuário/dadosalunos, informações de ocorrencias, histórico, 
        declaração de matricula, boletim, diploma, atestado, RELATÓRIO - */

        var documents = [] //todo documents no código se refere ao nome do vetor

        function setDocuments(req){

            // Expressões Regulares que formatam a entrada do usuário
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/


            // Validações das expressões regulares
            if (!emailRegex.test(req.email)){
                console.error("Erro: Email inválido. Deve estar no formato fulano@fulano.com \n Pode conter números.")
                return

            }

            let d = {//lista, registro, objAnonimo
                id: documents.length,
                name: req.name,
                email: req.email,                   
                telephone: req.telephone,
                dateBirth: req.dateBirth,
                nameMother: req.nameMother,
                level: req.level,
                grade:req.grade,
                period: req.period,                     
                createAt: req.createAt,      
                type: req.type                    
            }

            documents.push(d)                       //empurra o obj d na lista documents
            return "Documento adicionado!"          //Verifica o push
        }

        function putDocuments(req,id){
            let docIndex = documents.findIndex( d => d.id == id);
            
            if(docIndex == -1) return "Não Encontrado"

            if(req.name != undefined) documents[docIndex].name = req.name
            if(req.email != undefined) documents[docIndex].email = req.email
            if(req.telephone != undefined) documents[docIndex].telephone = req.telephone
            if(req.dateBirth != undefined) documents[docIndex].dateBirth = req.dateBirth
            if(req.nameMother != undefined) documents[docIndex].nameMother = req.nameMother
            if(req.level != undefined) documents[docIndex].level = req.level
            if(req.grade != undefined) documents[docIndex].grade = req.grade
            if(req.period != undefined) documents[docIndex].period = req.period

            documents[docIndex].id = id;//GARANTE QUE O ID SEJA ÚNICO


            return documents[docIndex];
            
        }


        function handleRegister(){
            let id = parseInt(document.getElementById('id').value)

            if(id == -1){
                console.log (
                    setDocuments({
                        //id:id,
                        name: document.getElementById("name").value,
                        email: document.getElementById("email").value,
                        telephone: document.getElementById("telephone").value,
                        dateBirth: document.getElementById("dateBirth").value,
                        nameMother: document.getElementById("nameMother").value,
                        level: document.getElementById("level").value,
                        grade: document.getElementById("grade").value,
                        period: document.getElementById("period").value, 
                        createAt: new Date().toISOString().split('T')[0]                                  
                    })
                )
                
            }else if(id > -1){//chamar função put
                
                console.log(
                    putDocuments({
                        id:id,
                        name: document.getElementById("name").value,
                        email: document.getElementById("email").value,
                        telephone: document.getElementById("telephone").value,
                        dateBirth: document.getElementById("dateBirth").value,
                        nameMother: document.getElementById("nameMother").value,
                        level: document.getElementById("level").value,
                        grade: document.getElementById("grade").value,
                        period: document.getElementById("period").value,
                    },id)
                )
                document.getElementById("id").value =-1
            }else{
                console.log("erro")
            }

            listDocuments(documents)
        }


        function editDocuments(id){
            let doc = documents.find( d => d.id == id)

            document.getElementById("name").value = doc.name
            document.getElementById("email").value = doc.email
            document.getElementById("telephone").value = doc.telephone
            document.getElementById("dateBirth").value = doc.dateBirth
            document.getElementById("nameMother").value = doc.nameMother
            document.getElementById("level").value = doc.level
            document.getElementById("grade").value = doc.grade
            document.getElementById("period").value = doc.period
        }

        function dellDocuments(id) {
            let docIndex = documents.findIndex(d => d.id == id);

            if (docIndex === -1) {
                console.error("Documento não encontrado para exclusão.");
                return;
            }

            documents.splice(docIndex, 1); // Remove o documento do array
            listDocuments(documents); // Atualiza a tabela
        }


        function listDocuments(pList){
            const tbody = document.querySelector("#tableBody")
            tbody.innerHTML = ""

            pList.forEach(d =>{            
                const row = document.createElement("tr");

                const nameCell = document.createElement("td");
                nameCell.textContent = d.name

                //EDITAR
                const editCell = document.createElement("td")
                const editButton = document.createElement("button")

                editButton.className = "round edit"
                editButton.textContent = "Editar"

                editButton.onclick = function(){
                    editDocuments(d.id)
                };
                editCell.appendChild(editButton)

                //DELETE
                const dellCell = document.createElement("td")
                const dellButton = document.createElement("button")
                dellButton.className = "round dell"
                dellButton.textContent = "Excluir"
                dellButton.onclick = function(){
                    dellDocuments(d.id)
                };
                dellCell.appendChild(dellButton)

                row.appendChild(nameCell)
                row.appendChild(editCell)
                row.appendChild(dellCell)
                tbody.appendChild(row)


            })
            
        }      


        //FILTRO
        /*const viewCell = document.createElement("td")
        const viewButton = document.createElement("button")

        viewButton.className = "view"
        viewCell.appendChild(viewButton)*/
    </script>
    
</html>
