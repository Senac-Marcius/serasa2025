<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="post.js"></script> -->
    <link rel="stylesheet" href="./style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Olá, Mundo!</title>
</head>

<body>
    <div class="container-titles">
        <h1>Cadastre seu objeto</h1>
    </div>
    <section id="scRegister">
        <div class="container-1">
            <input type="hidden" value="-1" id="id">
            <div class="container-input row mb-3">
                <label for="Title" class="col-sm-2 col-form-label">Titulo:</label>
                <div class="col-sm-5">
                    <input type="text" class="form-control" id="titles">
                </div>
            </div>
            <div class="container-input row mb-3">
                <label for="Descricao" class="col-sm-2 col-form-label">Descrição:</label>
                <div class="col-sm-5">
                    <textarea name="Descricao" class="form-control" id="description"></textarea>
                </div>
            </div>
            <button type="button" onclick="handleRegister()" class="btn btn-primary">Cadastrar</button>
        </div>
    </section>
    <section id="scList">
        <table class="table">
            <thead>
                <tr>
                <th scope="col">#</th>
                <th scope="col">Titulo</th>
                </tr>   
            </thead>
            <tbody>
                <tr>

                </tr>
            </tbody>
        </table>
    </section>


</body>
<script>
    var posts = []

    function setPost(req) {

        const datePattern = /^\d{4}-\d{2}-\d{2}$/;

        // if (!idPattern.test(req.id)) {
        //     return "Campo ID deve conter apenas números"
        // }

        // if (!idPattern.test(req.userId)) {
        //     return "Campo userId deve conter apenas números"
        // }

        if (!datePattern.test(req.createAt)) {
            return "Campo createAt deve conter o seguinte formato YYYY-MM-DD"
        }

        if (req.description.length > 244) {
            return "Campo description deve conter até 244 caracters"
        }

        if(req.titles.length > 65){
            return "Campo de titulo deve conter até 65 caracteres"
        }

        let p = {
            id: posts.length? posts[posts.length - 1].id + 1 : 0,
            description: req.description,
            titles: req.titles, // http://qualquercoisa. ou https://qualquercoisa.
            createAt: req.createAt, // YYYY-MM-DD
            userId: req.userId
        }
        posts.push(p)
        // localStorage.setItem('posts', JSON.stringify(posts))
        console.log('Cadastrado!!')
    }

    function handleRegister() {
        let id = document.getElementById('id').value

        if(id == -1){
            setPost({
            description: document.getElementById('description').value,
            titles: document.getElementById('titles').value,
            createAt: '2000-12-31',
            userId: 0
        })
    }else if(id > -1){
        editPost({
            id: document.getElementById('id').value,
            titles: document.getElementById('titles').value,
            description: document.getElementById('description').value
        }, id)
        document.getElementById('id').value = -1
    }else{
        console.log('erro!')
    }
        
        listPosts(posts)
        
    }

    function putPosts(id){
        let edit = posts.find(p => p.id == id)

        document.getElementById('id').value = edit.id
        document.getElementById('titles').value = edit.titles
        document.getElementById('description').value = edit.description
    }

    function editPost(req, id){
    let idx = posts.findIndex(p => p.id == id)

    if(idx == -1) return "Não encontrado"
    document.getElementById(`${id}`).textContent = req.titles

    if(req.description != undefined) posts[idx].description = req.description
    if(req.titles != undefined) posts[idx].titles = req.titles

    // localStorage.setItem('posts', JSON.stringify(posts))

    listPosts(posts)
}

function deletePost(id){
    let idx = posts.findIndex(p => p.id == id)

    if(idx == -1) return "Não encontrado"
    posts.splice(idx, 1)
    listPosts(posts)
}

    function listPosts(pList){
        const tbody = document.querySelector("#scList tbody")
        tbody.innerHTML = ""

        pList.forEach(p => {
            const row = document.createElement('tr')
            
            const titleCell = document.createElement('td')
            titleCell.textContent = p.titles

            titleCell.id = `${p.id}`

            const actionCell = document.createElement('td')

            const buttonEdit = document.createElement('button')
            buttonEdit.textContent = 'Edit'
            buttonEdit.classList.add('btn', 'btn-primary', 'btn-sm')
            buttonEdit.style.width = '50px'; // Definindo a largura
            buttonEdit.style.height = '30px'; // Definindo a altura
            buttonEdit.style.padding = '0'; // Removendo o padding para dar forma mais quadrada
            buttonEdit.style.fontSize = '12px'; // Definindo uma fonte menor para caber o texto
            buttonEdit.style.lineHeight = '1';
            buttonEdit.onclick = function(){
                putPosts(p.id)
            }

            const buttonDell = document.createElement('button')
            buttonDell.textContent = 'Delete'
            buttonDell.classList.add('btn', 'btn-danger', 'btn-sm')
            buttonDell.style.width = '50px'; // Definindo a largura
            buttonDell.style.height = '30px'; // Definindo a altura
            buttonDell.style.padding = '0'; // Removendo o padding para dar forma mais quadrada
            buttonDell.style.fontSize = '12px'; // Definindo uma fonte menor para caber o texto
            buttonDell.style.lineHeight = '1';
            buttonDell.onclick = function(){
                deletePost(p.id)
            }

            actionCell.appendChild(buttonEdit)
            actionCell.appendChild(buttonDell)

            
            row.appendChild(titleCell)
            row.appendChild(actionCell)
            tbody.appendChild(row)
        })

    }

    

    // window.onload = function() {
    //     listPosts(posts);
    // }
</script>

</html>