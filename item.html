<!DOCTYPE html>

<html lang="pt-br">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Itens</title>
        <style>
            /*
            Paleta

            */
            body {
                font-family: Arial, sans-serif;
                margin: 0px;
                padding: 20px;
                background-color: #eeeeee;
            }
            h1 {
                text-align: center;
                color: #2A17A6;
                background-color: #F2F2F2;
                margin: 0;
                padding: 20px;
            }
            h2{
                text-align: center;
            }
            section {
                display: flex;
                margin: 0 auto;
                flex-direction: column;
            }
            #scRegister{
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px;
                border: 1px solid #ffffff;
                border-radius: 8px;
                width: 300px;
                color: #432e80;
                box-shadow: 0 4px 4px 4px rgba(0, 0, 0, 0.2);
                background: rgb(255, 255, 255);
            }
            #scList {
                font-family: 'Arial', sans-serif;
                color: #8A2BE2;
                text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
                font-size: 25px;
                letter-spacing: 2px;
                color: #6b6190;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }
            .row {
                display: flex;
                margin-top: 50px;
                justify-content: center;
                padding: 20px;
            }
            label {
                display: block;
                margin-top: 10px;
                font-weight: 600;
            }
            label[for="title"]::after,
            label[for="subject"]::after,
            label[for="keywords"]::after {
                content: " *";
                color: red;
            }
            br {
                margin: 20px;
            }
            button {
                background-color: linear-gradient(135deg, #6e8efb, #a777e3);
                color: white;
                border: none;
                padding: 12px 24px;
                font-size: 16px;
                font-weight: bold;
                margin-top: 15px;
                cursor: pointer;
                width: 100%;
                border-radius: 8px;
                box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease-in-out;
                position: relative;
                overflow: hidden;
                display: block;
            }
            button:hover {
                background-color: linear-gradient(135deg, #5b77e0, #925ec4);
                box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.3);
                transform: translateY(-2px);
            }
            button:active {
                transform: translateY(1px);
                box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.2);
            }
            button.round {
                width: 35px;
                height: 35px;
                border-radius: 50%;
            }
            button.edit{
                background-color: yellow;
            }
            button.dell{
                background-color: red;
            }

            form {
                background: #7139BF;
                color: white;
                padding: 40px;
                border-radius: 20px;
                box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
                max-width: 400px;
                margin: 0 auto;
            }
            input {
                width: 100%;
                padding: 8px;
                margin-top: 5px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }
            table {
                width: 100%;
                margin-top: 20px;
                border-collapse: collapse;
                background: white;
            }
            th, td {
                border: 1px solid #ddd;
                padding: 10px;
                text-align: left;
            }
            th {
                background-color: #0F2259;
                color: white;
            }

        </style>
    </head>

    <body>
        <h1>Cadastramento de Itens</h1>
        <div class="row">
            <section id="scRegister">
                <form>
                    <input id ="id" type="hidden" value="-1"/>
                    <label for="typology">Tipologia: </label>
                    <select id="typology" name="opcoes">
                        <option id="opcao0">-</option>
                        <option id="opcao1">Livro</option>
                        <option id="opcao2">Publicação Seriada</option>
                        <option id="opcao3">Artigo</option>
                        <option id="opcao4">Audiolivro</option>
                        <option id="opcao5">Trabalho Acadêmico</option>
                        <option id="opcao6">Mapa</option>
                        <option id="opcao7">Outros</option>
                    </select><br>
                    <label for="title">Título: </label><input id="title" type="text" required /><br>
                    <label for="subtitle">Subtítulo: </label><input id="subtitle" type="text" /><br>
                    <label for="uniformTitle">Título Uniforme: </label><input id="uniformTitle" type="text" /><br>
                    <label for="responsible">Responsáveis: </label><input id="responsible" type="text" /><br>
                    <label for="translation">Tradução: </label><input id="translation" type="text" /><br>
                    <label for="edition">Edição: </label><input id="edition" type="text" placeholder=" Nº + ª" /><br>
                    <label for="location">Local: </label><input id="location" type="text" /><br>
                    <label for="publisher">Editora: </label><input id="publisher" type="text" /><br>
                    <label for="year">Ano: </label><input id="year" type="number" placeholder="AAAA" /><br>
                    <label for="language">Idioma: </label>
                    <select id="language" name="opcoes">
                        <option id="opcao0">-</option>
                        <option id="opcao1">Português</option>
                        <option id="opcao2">Inglês</option>
                        <option id="opcao3">Espanhol</option>
                        <option id="opcao4">Francês</option>
                        <option id="opcao5">Outros</option>
                    </select><br>
                    <label for="numberPages">Número de páginas: </label><input id="numberPages" type="number" /><br>
                    <label for="format">Formato: </label>
                    <select id="format" name="opcoes">
                        <option id="opcao0">-</option>
                        <option id="opcao1">Físico</option>
                        <option id="opcao2">Digital</option>
                    </select><br>
                    <label for="dimensions">Dimensões: </label><input id="dimensions" type="text" placeholder="XX.XX x XX.XX cm"  /><br>
                    <label for="serie">Série: </label><input id="serie" type="text" /><br>
                    <label for="volume">Volume: </label><input id="volume" type="number" /><br>
                    <label for="isbn">ISBN: </label><input id="isbn" type="text" /><br>
                    <label for="issn">ISSN: </label><input id="issn" type="text" /><br>
                    <label for="subject">Assuntos: </label><input id="subject" type="text" required /><br>
                    <label for="keywords">Palavras-chave: </label><input id="keywords" type="text" required /><br>
                    <label for="summary">Resumo: </label><textarea id="summary" type="text"></textarea><br>
                    <label for="notes">Notas: </label><textarea id="notes" type="text"></textarea><br>
                    <label for="additionalMaterial">Material adicional e suplementos: </label><textarea id="additionalMaterial" type="text"></textarea><br>
                    <label for="narrator">Narrador: </label><input id="narrator" type="text" /><br>
                    <label for="duration">Duração: </label><input id="duration" type="text" placeholder="HH:MM:SS"  /><br>
                    <label for="cdd">CDD: </label><input id="cdd" type="text" /><br>
                    <label for="callNumber">Número de Chamada: </label><input id="callNumber" type="text" /><br><br><br>
                    <button type="button" id="register" onclick="handleRegister()">CADASTRAR</button>
                </form>
            </section>
            
            <section id="scList" >
                <table>
                    <thead>
                        <th>Itens Cadastrados no Acervo</th>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </section>
        </div>
    </body>

    <script>
        var items =  [] // vetor

        function setItems (req){ //função de create
            const patterns = { //patterns = expressões regulares (regex)
                numberIntFields: /^\d+$/,  // Apenas números inteiros positivos
                textFields: /^[\s\S]*$/, // Aceita tudo
                isbn: /^\d{10}(\d{3})?$/, // ISBN-10 ou ISBN-13 (somente números, sem traços)
                issn: /^\d{4}-\d{4}$/, // ISSN no formato "1234-5678"
                dimensions: /^\d{2}\.\d{2} x \d{2}\.\d{2} cm$/,  // Formato "XX.XX x XX.XX cm"
                cdd: /^\d{3}(\.\d+)?$/,  // Código Decimal Dewey (ex: "150.195") com números e um ponto decimal.
                callNumber: /^[\w\d\s.-]*$/,  // Aceita letras, números, espaços, pontos e traços
                date: /^\d{4}-\d{2}-\d{2}$/, // Data no formato YYYY-MM-DD (Ex: 2019-12-05 / 2025-01-15)
                duration: /^([0-9]{2}):([0-5][0-9]):([0-5][0-9])$/ //formato HH:MM:SS (horas, minutos e segundos)
            }
            // Valida os campos com regras específicas
            if (!patterns.numberIntFields.test(req.numberPages) || !patterns.numberIntFields.test(req.volume) || !patterns.numberIntFields.test(req.year)){
                return "O campo deve conter apenas números"
            }
            if (!patterns.textFields.test(req.title) || !patterns.textFields.test(req.subtitle) || !patterns.textFields.test(req.uniformTitle) || !patterns.textFields.test(req.responsible) || 
                !patterns.textFields.test(req.translation) || !patterns.textFields.test(req.publisher) || !patterns.textFields.test(req.location) || !patterns.textFields.test(req.serie) || 
                !patterns.textFields.test(req.subject) || !patterns.textFields.test(req.keywords) || !patterns.textFields.test(req.summary) || !patterns.textFields.test(req.notes) || 
                !patterns.textFields.test(req.additionalMaterial) || !patterns.textFields.test(req.narrator)){
                return "Contém caracteres inválidos!"
            }
            if (!patterns.isbn.test(req.isbn)){
                return "Use o formato padrão ISBN-10 ou ISBN-13 (somente números, sem traços)"
            }
            if (!patterns.issn.test(req.issn)){
                return "Use o formato padrão: 1234-5678"
            }
            if (!patterns.dimensions.test(req.dimensions)){
                return "Use o formato padrão: 00.00 x 00.00 cm "
            } 
            if (!patterns.cdd.test(req.cdd)){
                return "Use o formato padrão: 000.000";
            }
            if (!patterns.callNumber.test(req.callNumber)){
                return "Use o formato padrão: cdd + tabela Cutter + inicial do título. Ex 150.095 I12m"
            } 
            if (!patterns.date.test(req.createAt)){
                return "Use o formato padrão: AAAA-MM-DD"
            }
            if (!patterns.duration.test(req.duration)){
                return "Use o formato padrão: HH:MM:SS (horas, minutos e segundos)"
            }

            let i = {
                id: items.length? items[items.length -1].id + 1: 0,
                createAt: req.createAt,
                title: req.title,
                subtitle: req.subtitle,
                uniformTitle: req.uniformTitle,
                responsible: req.responsible,
                translation: req.translation,
                year: req.year,
                edition: req.edition,
                publisher: req.publisher,
                location: req.location,
                numberPages: req. numberPages,
                dimensions: req.dimensions,
                serie: req.serie,
                volume: req.volume,       
                isbn: req.isbn,
                issn: req.issn,
                Cdd: req.cdd,
                callNumber: req.callNumber,
                subject: req.subject,
                keywords: req.keywords,
                summary: req.summary,
                notes: req.notes,
                additionalMaterial: req.additionalMaterial,
                narrator: req.narrator,
                duration: req.duration
            }
            items.push(i)
            return "Item Cadastrado com Sucesso!"
        }

        function handleRegister(){
        // Verificar se os campos obrigatórios estão preenchidos
            const title = document.getElementById("title").value.trim();
            const subject = document.getElementById("subject").value.trim();
            const keywords = document.getElementById("keywords").value.trim();

            if (!title || !subject || !keywords){
                alert("Por favor, preencha todos os campos obrigatórios: Título, Assunto e Palavras-chave.");
                return; // Interrompe a execução se algum campo estiver vazio
            }

            let id = document.getElementById("id").value

            if(id == -1){
                console.log(
                    setItems({
                        userId: 0,
                        createAt: "2025-02-25",
                        title: title,
                        subtitle: document.getElementById("subtitle").value.trim() || "",
                        uniformTitle: document.getElementById("uniformTitle").value.trim() || "",
                        responsible: document.getElementById("responsible").value.trim() || "",
                        translation: document.getElementById("translation").value.trim() || "",
                        edition: document.getElementById("edition").value.trim() || "",
                        location: document.getElementById("location").value.trim() || "",
                        publisher:document.getElementById("publisher").value.trim() || "",
                        year: parseInt(document.getElementById("year").value) || 0,
                        numberPages: parseInt(document.getElementById("numberPages").value) || 0,
                        dimensions:document.getElementById("dimensions").value.trim() || "",
                        serie: document.getElementById("serie").value.trim() || "",
                        volume: parseInt(document.getElementById("volume").value) || 0, 
                        isbn: document.getElementById("isbn").value.trim() || "",
                        issn: document.getElementById("issn").value.trim() || "",
                        cdd: document.getElementById("cdd").value.trim() || "",
                        callNumber: document.getElementById("callNumber").value.trim() || "",
                        subject: subject,
                        keywords: keywords,
                        summary: document.getElementById("summary").value.trim() || "",
                        notes: document.getElementById("notes").value.trim() || "",
                        additionalMaterial: document.getElementById("additionalMaterial").value.trim() || "",
                        narrator: document.getElementById("narrator").value.trim() || "",
                        duration: document.getElementById("duration").value.trim() || ""
                    })
                )
            }else if(id > -1){ // ### chamar a funcao put ###
                console.log(
                    putItems({
                        title: title,
                        subtitle: document.getElementById("subtitle").value.trim() || "",
                        uniformTitle: document.getElementById("uniformTitle").value.trim() || "",
                        responsible: document.getElementById("responsible").value.trim() || "",
                        translation: document.getElementById("translation").value.trim() || "",
                        edition: document.getElementById("edition").value.trim() || "",
                        location: document.getElementById("location").value.trim() || "",
                        publisher:document.getElementById("publisher").value.trim() || "",
                        year: parseInt(document.getElementById("year").value) || 0,
                        numberPages: parseInt(document.getElementById("numberPages").value) || 0,
                        dimensions:document.getElementById("dimensions").value.trim() || "",
                        serie: document.getElementById("serie").value.trim() || "",
                        volume: parseInt(document.getElementById("volume").value) || 0, 
                        isbn: document.getElementById("isbn").value.trim() || "",
                        issn: document.getElementById("issn").value.trim() || "",
                        cdd: document.getElementById("cdd").value.trim() || "",
                        callNumber: document.getElementById("callNumber").value.trim() || "",
                        subject: subject,
                        keywords: keywords,
                        summary: document.getElementById("summary").value.trim() || "",
                        notes: document.getElementById("notes").value.trim() || "",
                        additionalMaterial: document.getElementById("additionalMaterial").value.trim() || "",
                        narrator: document.getElementById("narrator").value.trim() || "",
                        duration: document.getElementById("duration").value.trim() || ""
                    }, id)
                )

                document.getElementById("id").value = -1
            }else{
                console.log("erro")
            }

            listItems(items)
        }

        function putItems(req, id){
            let idx = items.findIndex(i=> i.id == id)

            if(idx == -1) return "não encontrado"
            if(req.title!= undefined) items[idx].title = req.title
            if(req.subtitle!= undefined)items[idx].subtitle = req.subtitle
            if(req.responsible!= undefined)items[idx].responsible = req.responsible
            if(req.uniformTitle!= undefined)items[idx].uniformTitle = req.uniformTitle
            if(req.subject!= undefined)items[idx].subject = req.subject
            if(req.id!= undefined)items[idx].id = req.id

            return items[idx]
        }

        function editItems(id){
            let item = items.find(i => i.id == id)

            document.getElementById("id").value = item.id,
            document.getElementById("title").value = item.title,
            document.getElementById("subtitle").value = item.subtitle,
            document.getElementById("uniformTitle").value = item.uniformTitle,
            document.getElementById("responsible").value = item.responsible,
            document.getElementById("translation").value = item.translation,
            document.getElementById("edition").value = item.edition,
            document.getElementById("location").value = item.location,
            document.getElementById("publisher").value = item.publisher,
            parseInt(document.getElementById("year").value) || 0 == item.year,
            parseInt(document.getElementById("numberPages").value) || 0 == item.numberPages,
            document.getElementById("dimensions").value = item.dimensions,
            document.getElementById("serie").value = item.serie,
            parseInt(document.getElementById("volume").value) || 0 == item.volume,
            document.getElementById("isbn").value = item.isbn,
            document.getElementById("issn").value = item.issn,
            document.getElementById("cdd").value = item.cdd,
            document.getElementById("callNumber").value = item.callNumber,
            document.getElementById("subject").value = item.subject,
            document.getElementById("keywords").value = item.keywords,
            document.getElementById("summary").value = item.summary,
            document.getElementById("notes").value = item.notes,
            document.getElementById("additionalMaterial").value = item.additionalMaterial,
            document.getElementById("narrator").value = item.narrator,
            document.getElementById("duration").value = item.duration
        }

        function dellItems(id){
            let idx = items.findIndex(i => i.id == id)

            if (idx == -1) return "não encontrado"

            items.splice(idx, 1)

            listItems(items)

            return "Item excluído"
        }

        function listItems(iList){
            const tbody = document.querySelector("#scList tbody") //o # indica q está procurando o Id. 
            tbody.innerHTML = "" // Limpa a tabela antes de atualizar

            iList.forEach(i => {
                const row = document.createElement("tr") //tr= table row

                const titleCell = document.createElement("td")
                titleCell.textContent = i.title

                const editCell = document.createElement("td")  //criar uma célula
                const editButton = document.createElement("button")  //criar um botão
                editButton.className = "round edit"
                editButton.onclick = function() {
                    editItems(i.id)
                };
                editCell.appendChild(editButton) //colocar o botão dentro da célula

                const dellCell = document.createElement("td")
                const dellButton = document.createElement("button")
                dellButton.className = "round dell"
                dellButton.onclick = function(){
                    dellItems(i.id)
                }
                dellCell.appendChild(dellButton)

                row.appendChild(titleCell);
                row.appendChild(editCell);
                row.appendChild(dellCell);
                tbody.appendChild(row);
            });
        }
    </script>
</html>